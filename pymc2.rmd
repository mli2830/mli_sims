---
title: "new test"
date: "`r format(Sys.time(), '%H:%M %d %B %Y ')`"
author: Michael Li
---

# testing
```{r opts,message=FALSE,echo=FALSE,warning=FALSE}
library("knitr")
opts_chunk$set(tidy=FALSE,engine='python',engine.path='/Users/mikemike/anaconda/bin/python')
```

#Simulating data

```{r pymc2}
import numpy as np
from pymc3 import Model, Uniform, Binomial, find_MAP, NUTS, sample, Slice, traceplot
from scipy import optimize

# Parameters
effprop = 0.9
beta = 0.02
N = 100
i0 = 1
t0 = 0
numobs = 20
reporting = 1

# Set up seed
np.random.seed(111)

S = [0] * numobs
I = [0] * numobs
R = [0] * numobs
Iobs = [0] * numobs
Psi = [0] * numobs

print(I)
print(I[0])

# Initial 
N0 = effprop*N
I[0] = i0
S[0] = N0 - i0
R[0] = N-N0
Psi[0] = 1 - (1-beta)**I[0]
Iobs[0] = np.random.binomial(I[0],reporting,1)

print(Iobs)
print(Iobs[0])

print(S[0])
print(S[0] * Psi[0])
print(Psi)

for t in range(1,numobs-1):
  I[t] = np.random.binomial(S[t-1],Psi[t-1],1)
  S[t] = S[t-1] - I[t]
  R[t] = R[t-1] + I[t-1]
  Psi[t] = 1 - (1-beta)**I[t]
  Iobs[t] = np.random.binomial(I[t],reporting,1) 

print(Iobs)

for a in range(0,numobs-1):
  print(Iobs[a])

print(i0,N0)
## going to fit 

# 
# basic_model = Model()
# 
# with basic_model:
#     # Priors for unknown model parameters
#     effprop = Uniform('effprop', lower=0 , upper=1)
#     beta = Uniform('beta', lower=0, upper=0.3)
#     reporting = Uniform('reporting', lower=0, upper=1)
# 
#     # ~ node magic
#     N0_obs = Binomial("N0_obs",n=N,p=effprop,observed=N0)
#     I[0] = Binomial("I[0]",n=i0,p=1,observed=I[0])
#     S[0] = N0 - I[0]
#     Psi[0] = 1 - (1-beta)**I[0]
#     
#     # Likelihood (sampling distribution) of observations
#     I_obs[0] = Binomial("Iobs[0]",n=I[0],p=reporting,observed=Iobs[0])
#     for t in range(1,numobs-1):
#       I[t] = Binomial("I[t]",S[t-1],Psi[t-1],observed=I[t])
#       S[t] = S[t-1] - I[t]
#       R[t] = R[t-1] + I[t-1]
#       Psi[t] = 1 - (1-beta)**I[t]
#       I_obs[t] = Binomial("I_obs[t]",I[t],p=reporting,observed=Iobs[t]) 
#     
# 
# map_estimate = find_MAP(model=basic_model)
# print(map_estimate)
# 
# 
# with basic_model:
# 
#     # obtain starting values via MAP
#     start = find_MAP(fmin=optimize.fmin_powell)
# 
#     # instantiate sampler
#     #step = Slice(vars=[reporting]) 
# 
#     # draw 1000 posterior samples
#     trace = sample(1000, start=start) 
#     
# summary(trace)


```
